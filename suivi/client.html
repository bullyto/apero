<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Suivi de commande ‚Ä¢ Ap√©ro de Nuit 66</title>

  <link rel="stylesheet" href="./style.css">
  <link rel="icon" href="./assets/icon-192.png">

  <!-- IMPORTANT: pas de manifest ici -> le navigateur ne proposera pas d'installer la PWA c√¥t√© client -->
  <link rel="preconnect" href="https://unpkg.com">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

  <!-- ‚úÖ Style & couleurs identiques (bleu nuit + bleu "Commander") + corrections demand√©es -->
  <style>
    :root{
      --adn-blue:#0b1c2d;
      --adn-sky:#5db7ee; /* ‚úÖ BLEU "Commander" */
      --adn-line:rgba(93,183,238,.95);
      --adn-shadow:rgba(93,183,238,.22);
      --adn-text:#0b1c2d;
    }

    /* Bandeau haut coh√©rent */
    header.clientTopbar{
      background: var(--adn-blue) !important;
    }

    /* Layout topbar */
    .clientTopbar{
      display:flex !important;
      align-items:center !important;
      justify-content:space-between !important;
      gap:10px !important;
      padding-left:12px !important;
      padding-right:12px !important;
    }

    .topBrand{
      flex:1 1 auto;
      display:flex;
      justify-content:center;
      align-items:center;
      min-width:0;
    }
    .topTimer, .topState{
      flex:0 0 auto;
    }
    .topBrandLogo{
      max-height:34px;
      height:auto;
      width:auto;
      display:block;
    }

    /* ‚úÖ Bouton Retour: plus de 404 -> history.back() + fallback */
    .clientBackBtn{
      appearance:none;
      border:none;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:10px 14px;
      border-radius:14px;
      font-weight:900;
      font-size:14px;
      color:#fff;
      background:var(--adn-sky);
      box-shadow:0 10px 18px rgba(93,183,238,.32);
      text-decoration:none;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      line-height:1;
      white-space:nowrap;
    }
    .clientBackBtn:active{ transform: translateY(1px); }

    /* ‚úÖ POPUP: blanche + contour bleu comme "Commander" */
    .clientPopupCard{
      background:#fff !important;
      border:2px solid var(--adn-line) !important;
      box-shadow:0 16px 38px rgba(0,0,0,.12), 0 0 0 4px var(--adn-shadow) !important;
      color:var(--adn-text) !important;
    }
    .clientPopupTitle{
      color:var(--adn-text) !important;
    }
    .clientPopupSub{
      color:rgba(11,28,45,.70) !important;
    }
    .clientInput{
      border:2px solid rgba(93,183,238,.55) !important;
      background:#fff !important;
      color:var(--adn-text) !important;
      border-radius:14px !important;
      box-shadow: 0 8px 18px rgba(93,183,238,.10) !important;
    }
    .clientInput:focus{
      outline:none !important;
      border-color: rgba(93,183,238,1) !important;
      box-shadow: 0 0 0 4px rgba(93,183,238,.18) !important;
    }

    /* ‚úÖ Bouton "Suivi" (Activer le suivi) = m√™me couleur que "Commander" */
    .clientBtn{
      background:var(--adn-sky) !important;
      color:#fff !important;
      border:2px solid rgba(255,255,255,.0) !important;
      box-shadow:0 10px 18px rgba(93,183,238,.28) !important;
      border-radius:14px !important;
      font-weight:900 !important;
    }
    .clientBtn:active{ transform: translateY(1px); }

    /* Bouton secondaire reste discret */
    .clientBtn.secondary{
      background:#fff !important;
      color:var(--adn-text) !important;
      border:2px solid rgba(11,28,45,.18) !important;
      box-shadow:none !important;
      font-weight:800 !important;
    }

    @media (max-width: 360px){
      .clientBackBtn{ padding:9px 10px; font-size:13px; }
      .topBrandLogo{ max-height:30px; }
    }
  </style>
</head>

<body class="client">
  <div class="clientShell">
    <!-- La carte occupe tout l‚Äô√©cran. Le bandeau + popup passent AU-DESSUS. -->
    <div class="mapWrap clientMapWrap" aria-label="Carte">
      <div id="map" class="clientMap"></div>

      <header class="clientTopbar" aria-label="Bandeau suivi">
        <!-- ‚úÖ Retour robuste (pas de 404) -->
        <button class="clientBackBtn" type="button" id="btnBack" aria-label="Retour">‚Üê Retour</button>

        <div class="topBrand" aria-label="Marque">
          <!-- ‚úÖ Logo: essaie ./assets puis fallback ../assets -->
          <img class="topBrandLogo" alt="Ap√©ro de Nuit 66"
               src="./assets/logo-header.png"
               onerror="this.onerror=null; this.src='../assets/logo-header.png';">
        </div>

        <div class="topTimer" aria-label="Temps restant">
          <span class="topIcon" aria-hidden="true">‚è±Ô∏è</span>
          <span id="countdown">‚Äî</span>
        </div>

        <div class="topState" aria-label="√âtat">
          <span class="dot" aria-hidden="true"></span>
          <span id="stateText">‚Äî</span>
        </div>
      </header>

      <!-- Popup minimaliste au-dessus de la carte -->
      <section class="clientPopup" aria-label="Panneau de suivi" aria-live="polite">
        <div class="clientPopupCard">
          <h1 class="clientPopupTitle">Suivi en direct</h1>
          <p class="clientPopupSub">Indiquez votre pr√©nom pour activer le suivi.</p>

          <div class="clientPopupRow" aria-label="Statut g√©olocalisation">
            <span class="clientPopupRowI" aria-hidden="true">üìç</span>
            <span id="geoText">en attente‚Ä¶</span>
          </div>

          <div class="clientForm">
            <label class="clientLabel" for="name"></label>
            <input id="name" class="clientInput" maxlength="24" autocomplete="given-name" placeholder="Ex: Lucas">
          </div>

          <div class="clientBtnRow">
            <button id="btnRequest" class="clientBtn" type="button">Activer le suivi</button>
            <button id="btnReset" class="clientBtn secondary" type="button" style="display:none">Relancer</button>
          </div>

          <div class="clientHint"></div>
        </div>
      </section>

      <div class="legal">L‚Äôabus d‚Äôalcool est dangereux pour la sant√©, √† consommer avec mod√©ration.</div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script type="module" src="./client.js"></script>

  <!-- ‚úÖ Back: history + fallback index -->
  <script>
    (function(){
      const btn = document.getElementById("btnBack");
      if(!btn) return;
      btn.addEventListener("click", () => {
        try{
          if (window.history && history.length > 1) {
            history.back();
          } else {
            // fallback robuste
            const base = location.pathname.replace(/[^\/]+$/, "");
            location.href = base + "index.html";
          }
        }catch(e){
          location.href = "index.html";
        }
      });
    })();
  </script>
</body>
</html>
