<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Ap√©ro de Nuit 66</title>

  <style>
    :root{ --blue:#0b1c2d; --sky:#5db7ee; --text:#0b1c2d; }
    *{box-sizing:border-box}

    body{
      margin:0; height:100dvh; display:flex; flex-direction:column;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:#fff; color:var(--text); overflow:hidden;
    }

    .top{background:var(--blue);padding-bottom:8px}
    .top img{width:100%;max-height:26vh;object-fit:contain;display:block}

    .mid{text-align:center;padding:18px 14px 6px}
    .mid h1{margin:0;font-size:clamp(26px,6vw,40px);color:var(--sky);font-weight:900}
    .brand66{position:relative;display:inline-block}
    .brand66 .reg{position:absolute;top:-0.2em;right:-0.4em;font-size:1em;font-weight:800}

    .stage{flex:1;display:flex;justify-content:center;padding:12px}
    .bottleWrap{
      position:relative;width:min(520px,96vw);min-height:60vh;
      display:flex;justify-content:center;align-items:flex-start;
    }
    .bottleWrap img{
      position:absolute;max-height:56vh;max-width:100%;width:auto;
      opacity:0;transition:opacity .4s ease;
    }
    .bottleWrap img.active{opacity:1}

    .btnStack{
      position:absolute;bottom:14vh;left:50%;transform:translateX(-50%);
      width:min(420px,86vw);z-index:5;
    }
    .btn{
      width:100%;border:none;border-radius:16px;padding:14px;
      font-size:18px;font-weight:900;cursor:pointer;
    }
    .btn + .btn{margin-top:10px}
    .btn.primary{background:var(--sky);color:#fff}
    .btn.secondary{background:rgba(255,255,255,.85);color:#0b1c2d;border:1px solid rgba(11,28,45,.25)}

    /* MODALE DESIGN */
    .modal{
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;
      padding:18px;background:rgba(0,0,0,.55);z-index:999;
    }
    .modal.open{display:flex}

    .sheet{
      width:min(520px,94vw);background:#fff;border-radius:22px;
      box-shadow:0 18px 60px rgba(0,0,0,.25);padding:18px 16px 14px;
    }
    .sheetHead{display:flex;gap:12px;margin-bottom:8px;align-items:flex-start}
    .sheetIcon{
      width:40px;height:40px;border-radius:14px;display:flex;align-items:center;justify-content:center;
      background:rgba(93,183,238,.18);font-size:20px;
    }
    .sheet h3{margin:0;font-size:18px;color:var(--blue);line-height:1.2}
    .sheet p{margin:10px 0;color:rgba(0,0,0,.75);font-size:14px;line-height:1.35}

    .step{
      background:rgba(11,28,45,.06);border:1px solid rgba(11,28,45,.08);
      border-radius:16px;padding:10px 12px;margin:10px 0;font-size:14px;line-height:1.35;
    }

    .modalActions{
      display:flex;gap:10px;justify-content:flex-end;margin-top:14px;flex-wrap:wrap;
    }
    .okBtn,.copyBtn{
      border:none;border-radius:14px;padding:12px 16px;font-weight:900;cursor:pointer;
    }
    .okBtn{background:var(--sky);color:#fff;min-width:110px}
    .copyBtn{background:rgba(93,183,238,.18);color:var(--blue)}

    .copied{
      font-size:13px;color:#1b7f2a;margin-top:6px;display:none;
    }
  </style>
</head>

<body>
  <header class="top">
    <img src="assets/logo-header.png" alt="">
  </header>

  <section class="mid">
    <h1>AP√âRO DE NUIT <span class="brand66">66<span class="reg">¬Æ</span></span></h1>
  </section>

  <main class="stage">
    <div class="bottleWrap" id="bottles">
      <img src="assets/bottle1.png" class="active" alt="">
      <img src="assets/bottle2.png" alt="">
      <img src="assets/bottle3.png" alt="">
      <img src="assets/bottle4.png" alt="">
      <img src="assets/bottle5.png" alt="">
      <img src="assets/bottle6.png" alt="">
      <img src="assets/bottle7.png" alt="">

      <div class="btnStack">
        <button class="btn primary" id="goBtn">Commander</button>
        <button class="btn secondary" id="installBtn">Ajouter l‚Äôapp</button>
      </div>
    </div>
  </main>

  <!-- MODALE -->
  <div class="modal" id="helpModal" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
    <div class="sheet">
      <div class="sheetHead">
        <div class="sheetIcon" id="helpIcon">üì≤</div>
        <div>
          <h3 id="helpTitle">Installer l‚Äôapp</h3>
          <p id="helpIntro"></p>
        </div>
      </div>

      <div class="step" id="helpSteps"></div>
      <div class="copied" id="copiedMsg">‚úÖ Lien copi√©</div>

      <div class="modalActions">
        <button class="copyBtn" id="copyLinkBtn" style="display:none">Copier le lien</button>
        <button class="okBtn" id="closeHelp">OK</button>
      </div>
    </div>
  </div>

  <script>
    // Commander
    document.getElementById("goBtn").addEventListener("click", () => {
      window.location.href = "https://aperodenuit.com/commander";
    });

    // D√©filement bouteilles (2s)
    const imgs = document.querySelectorAll("#bottles img");
    let idx = 0;
    if (imgs.length > 1) {
      setInterval(() => {
        imgs[idx].classList.remove("active");
        idx = (idx + 1) % imgs.length;
        imgs[idx].classList.add("active");
      }, 2000);
    }

    // D√©tections
    const ua = navigator.userAgent || "";
    const isFBInApp = /FBAN|FBAV|FB_IAB|FB4A|FB4i|Instagram/i.test(ua);
    const isIOS = /iPhone|iPad|iPod/i.test(ua);
    const isSafari = /^((?!chrome|android).)*safari/i.test(ua);

    // PWA prompt Android/Chrome
    let deferredPrompt = null;
    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
    });

    // Modale helpers
    const modal = document.getElementById("helpModal");
    const closeBtn = document.getElementById("closeHelp");
    const copyBtn = document.getElementById("copyLinkBtn");
    const copiedMsg = document.getElementById("copiedMsg");
    const intro = document.getElementById("helpIntro");
    const steps = document.getElementById("helpSteps");
    const title = document.getElementById("helpTitle");
    const icon = document.getElementById("helpIcon");

    function openModal({t="Installer l‚Äôapp", i="", s="", showCopy=false, ic="üì≤"}) {
      title.textContent = t;
      icon.textContent = ic;
      intro.innerHTML = i;
      steps.innerHTML = s;
      copyBtn.style.display = showCopy ? "inline-block" : "none";
      copiedMsg.style.display = "none";
      modal.classList.add("open");
    }

    closeBtn.addEventListener("click", () => modal.classList.remove("open"));
    modal.addEventListener("click", (e) => { if (e.target === modal) modal.classList.remove("open"); });

    // Copier lien
    copyBtn.addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(window.location.href);
        copiedMsg.style.display = "block";
      } catch (e) {
        // fallback vieux navigateurs
        const tmp = document.createElement("textarea");
        tmp.value = window.location.href;
        document.body.appendChild(tmp);
        tmp.select();
        document.execCommand("copy");
        document.body.removeChild(tmp);
        copiedMsg.style.display = "block";
      }
    });

    // Click Ajouter l'app
    document.getElementById("installBtn").addEventListener("click", async () => {

      // 1) Facebook/Instagram in-app : modale + copier lien
      if (isFBInApp) {
        openModal({
          ic:"üì£",
          t:"Ouvrir dans un navigateur",
          i:"Facebook / Instagram bloque l‚Äôinstallation de l‚Äôapp.",
          s:
            "<strong>Solution :</strong><br><br>" +
            "1) Clique sur <strong>Copier le lien</strong><br>" +
            "2) Ouvre <strong>Chrome</strong> (Android) ou <strong>Safari</strong> (iPhone)<br>" +
            "3) Colle le lien dans la barre d‚Äôadresse, puis re-clique sur <strong>Ajouter l‚Äôapp</strong>",
          showCopy:true
        });
        return;
      }

      // 2) Si popup native dispo : on d√©clenche UNIQUEMENT la popup
      if (deferredPrompt) {
        deferredPrompt.prompt();
        try { await deferredPrompt.userChoice; } catch(e) {}
        deferredPrompt = null;
        return;
      }

      // 3) iPhone Safari : instructions Apple (pas de popup native)
      if (isIOS && isSafari) {
        openModal({
          ic:"üçè",
          t:"Ajouter √† l‚Äô√©cran d‚Äôaccueil",
          i:"Sur iPhone, l‚Äôinstallation se fait via le bouton Partager.",
          s:
            "<strong>√âtapes :</strong><br><br>" +
            "1) Appuie sur <strong>Partager</strong> (carr√© + fl√®che)<br>" +
            "2) Choisis <strong>Sur l‚Äô√©cran d‚Äôaccueil</strong><br>" +
            "3) Valide <strong>Ajouter</strong>"
        });
        return;
      }

      // 4) Autres cas : message utile + copier lien (√ßa aide toujours)
      openModal({
        ic:"‚ö†Ô∏è",
        t:"Installation indisponible",
        i:"Ton navigateur ne propose pas l‚Äôinstallation automatique.",
        s:
          "Essaie avec <strong>Chrome</strong> (Android) ou <strong>Safari</strong> (iPhone).<br>" +
          "Si tu es sur une appli (Facebook, etc.), ouvre le lien dans un navigateur.",
        showCopy:true
      });
    });
  </script>
</body>
</html>
