<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

  <title>ApÃ©ro de Nuit 66</title>

  <style>
    :root {
      --blue:#0b1c2d;
      --sky:#5db7ee;
      --text:#0b1c2d;
    }
    *{box-sizing:border-box}

    body{
      margin:0;
      height:100dvh;
      display:flex;
      flex-direction:column;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#fff;
      color:var(--text);
      overflow:hidden;
    }

    /* HEADER */
    .top{ background:var(--blue); padding-bottom:8px; }
    .top img{ display:block; width:100%; max-height:26vh; object-fit:contain; }

    /* TITRE */
    .mid{ text-align:center; padding:18px 14px 6px; }
    .mid h1{
      margin:0;
      font-size:clamp(26px,6vw,40px);
      color:var(--sky);
      font-weight:900;
    }
    .brand66{ position:relative; display:inline-block; }
    .brand66 .reg{
      position:absolute;
      top:-0.2em;
      right:-0.4em;
      font-size:1em;
      font-weight:800;
    }

    /* ZONE BOUTEILLES */
    .stage{ flex:1; display:flex; justify-content:center; padding:12px; }
    .bottleWrap{
      position:relative;
      width:min(520px,96vw);
      min-height:60vh;
      display:flex;
      justify-content:center;
      align-items:flex-start;
    }
    .bottleWrap img{
      position:absolute;
      max-height:56vh;
      max-width:100%;
      width:auto;
      opacity:0;
      transition:opacity .4s ease;
    }
    .bottleWrap img.active{ opacity:1; }

    /* BOUTONS */
    .btnStack{
      position:absolute;
      bottom:14vh;
      left:50%;
      transform:translateX(-50%);
      width:min(420px,86vw);
      z-index:5;
    }
    .btn{
      width:100%;
      border:none;
      border-radius:16px;
      padding:14px;
      font-size:18px;
      font-weight:900;
      cursor:pointer;
    }
    .btn + .btn{ margin-top:10px; }

    .btn.primary{ background:var(--sky); color:#fff; }
    .btn.secondary{
      background:rgba(255,255,255,0.85);
      color:#0b1c2d;
      border:1px solid rgba(11,28,45,.25);
    }

    /* MODALE (uniquement pour Facebook in-app ou iPhone Safari) */
    .modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      background:rgba(0,0,0,.55);
      z-index:999;
    }
    .modal.open{ display:flex; }

    .sheet{
      width:min(520px, 94vw);
      background:#fff;
      border-radius:22px;
      box-shadow:0 18px 60px rgba(0,0,0,.25);
      padding:18px 16px 14px;
    }
    .sheetHead{
      display:flex;
      align-items:flex-start;
      gap:12px;
      margin-bottom:10px;
    }
    .sheetIcon{
      width:40px; height:40px;
      border-radius:14px;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(93,183,238,.18);
      font-size:20px;
    }
    .sheet h3{
      margin:0;
      font-size:18px;
      color:var(--blue);
      line-height:1.2;
    }
    .sheet p{
      margin:10px 0;
      color:rgba(0,0,0,.75);
      line-height:1.35;
      font-size:14px;
    }
    .step{
      background:rgba(11,28,45,.06);
      border:1px solid rgba(11,28,45,.08);
      border-radius:16px;
      padding:10px 12px;
      margin:10px 0;
    }
    .modalActions{
      display:flex;
      justify-content:flex-end;
      margin-top:12px;
    }
    .okBtn{
      border:none;
      border-radius:14px;
      padding:12px 16px;
      font-weight:900;
      background:var(--sky);
      color:#fff;
      cursor:pointer;
      min-width:110px;
    }
  </style>
</head>

<body>

  <header class="top">
    <img src="assets/logo-header.png" alt="ApÃ©ro de Nuit">
  </header>

  <section class="mid">
    <h1>APÃ‰RO DE NUIT <span class="brand66">66<span class="reg">Â®</span></span></h1>
  </section>

  <main class="stage">
    <div class="bottleWrap" id="bottles">
      <img src="assets/bottle1.png" class="active" alt="">
      <img src="assets/bottle2.png" alt="">
      <img src="assets/bottle3.png" alt="">
      <img src="assets/bottle4.png" alt="">
      <img src="assets/bottle5.png" alt="">
      <img src="assets/bottle6.png" alt="">
      <img src="assets/bottle7.png" alt="">

      <div class="btnStack">
        <button class="btn primary" id="goBtn">Commander</button>
        <button class="btn secondary" id="installBtn">Ajouter lâ€™app</button>
      </div>
    </div>
  </main>

  <!-- Modale (Facebook in-app OU iPhone Safari uniquement) -->
  <div class="modal" id="helpModal" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
    <div class="sheet">
      <div class="sheetHead">
        <div class="sheetIcon">ðŸ“²</div>
        <div>
          <h3 id="helpTitle">Installer lâ€™app</h3>
          <p id="helpIntro"> </p>
        </div>
      </div>

      <div class="step" id="helpSteps"></div>

      <div class="modalActions">
        <button class="okBtn" id="closeHelp">OK</button>
      </div>
    </div>
  </div>

  <script>
    // ===== Commander =====
    document.getElementById("goBtn").addEventListener("click", () => {
      window.location.href = "https://aperodenuit.com/commander";
    });

    // ===== DÃ©filement bouteilles (2s) =====
    const bottles = document.querySelectorAll("#bottles img");
    let index = 0;
    if (bottles.length > 1) {
      setInterval(() => {
        bottles[index].classList.remove("active");
        index = (index + 1) % bottles.length;
        bottles[index].classList.add("active");
      }, 2000);
    }

    // ===== DÃ©tection Facebook / Instagram in-app =====
    const ua = navigator.userAgent || "";
    const isFacebookInApp = /FBAN|FBAV|FB_IAB|FB4A|FB4i|Instagram/i.test(ua);

    // ===== iOS Safari (pas de vraie popup install) =====
    const isIOS = /iPhone|iPad|iPod/i.test(ua);
    const isSafari = /^((?!chrome|android).)*safari/i.test(ua);

    // ===== PWA install prompt (Android/Chrome etc.) =====
    let deferredPrompt = null;
    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e; // -> popup native dispo
    });

    // ===== Modale helpers =====
    const helpModal = document.getElementById("helpModal");
    const closeHelp = document.getElementById("closeHelp");
    const helpIntro = document.getElementById("helpIntro");
    const helpSteps = document.getElementById("helpSteps");

    function openModal(introHtml, stepsHtml){
      helpIntro.innerHTML = introHtml;
      helpSteps.innerHTML = stepsHtml;
      helpModal.classList.add("open");
    }

    closeHelp.addEventListener("click", () => helpModal.classList.remove("open"));
    helpModal.addEventListener("click", (e) => { if(e.target === helpModal) helpModal.classList.remove("open"); });

    // ===== Click "Ajouter lâ€™app" =====
    document.getElementById("installBtn").addEventListener("click", async () => {

      // 1) Facebook/Instagram in-app => UNIQUEMENT la modale "ouvrir dans Chrome/Safari"
      if (isFacebookInApp) {
        openModal(
          "Facebook/Instagram ne permet pas lâ€™installation.",
          "<strong>Ouvre dans un vrai navigateur :</strong><br><br>" +
          "â€¢ Appuie sur <strong>â‹¯</strong> (menu) en haut Ã  droite<br>" +
          "â€¢ Choisis <strong>Ouvrir dans Chrome</strong> (Android) ou <strong>Ouvrir dans Safari</strong> (iPhone)<br>" +
          "â€¢ Reviens ici et clique sur <strong>Ajouter lâ€™app</strong>"
        );
        return;
      }

      // 2) Si la popup native est dispo => on l'affiche (UNIQUEMENT la popup)
      if (deferredPrompt) {
        deferredPrompt.prompt();
        try { await deferredPrompt.userChoice; } catch(e) {}
        deferredPrompt = null;
        return;
      }

      // 3) iPhone Safari => pas de popup native -> instructions iOS
      if (isIOS && isSafari) {
        openModal(
          "Sur iPhone, lâ€™installation se fait via le bouton Partager.",
          "<strong>Ã‰tapes :</strong><br><br>" +
          "â€¢ Appuie sur <strong>Partager</strong> (icÃ´ne carrÃ© + flÃ¨che)<br>" +
          "â€¢ Choisis <strong>Sur lâ€™Ã©cran dâ€™accueil</strong><br>" +
          "â€¢ Valide <strong>Ajouter</strong>"
        );
        return;
      }

      // 4) Autres cas (Chrome dÃ©jÃ  installÃ© / pas Ã©ligible PWA) -> petit message propre
      openModal(
        "Installation indisponible sur ce navigateur.",
        "Essaie avec <strong>Chrome</strong> (Android) ou <strong>Safari</strong> (iPhone)."
      );
    });
  </script>

</body>
</html>
